---
title: "Analysis for Survey 2"
author: "Anthony Staines"
date: "07/04/2020"
output:
  pdf_document:
    latex_engine: xelatex
  html_document: default
editor_options:
  chunk_output_type: console
---
# Setup
```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(readxl)
library(questionr)
library(gmodels)
library(sjPlot)
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, results = "hide",
                      cache=TRUE, fig.width=7.5, fig.height=6, dpi=600)
```

# Introduction

This file loads the survey data, with weights and a small number of extra key variables - Sex, Age, County and Education.

It then does two things. It cleans and transforms the variables, and it produces some analyses, mostly picture. Finally it writes the transformed data files back to an r data base.

## Load the data

```{r Load data}
load('data/Survey2/Survey_2.rda')
# Dataframe is called VV_2, contains eligible responses and survey weights.

#VV_2$weight = 1 # Unweighted
VV_2$weight = VV_2$Weights # Weighted

```

# Demographic questions

### Q3 Age

```{r age}
g <- ggplot(data=VV_2, aes(x=Age, weight=weight)) +
  geom_histogram(fill='yellow',colour='black') +
  xlab('Age') + ylab('Count') +
  ggtitle('Age in years') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-90, hjust=0))
g
##ggsave('images/Age_.png',  g, width=10,height=7, units='in', dpi= 1200)

g <- ggplot(data=VV_2, aes(x = Age, y = Sex, weight=weight)) +
  geom_boxplot(fill='yellow',colour='black') +
  xlab('Age') + ylab('Count') +
  ggtitle('Age in years') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-90, hjust=0))
g
##ggsave('images/Age_BW.png',  g, width=10,height=7, units='in', dpi= 1200)

```

This is an older sample, with a median age of 46, and a very wide (self-reported) age range.

## Q4 Gender

```{r Gender}
g <- ggplot(data=VV_2, aes(x=Sex, weight=weight)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Gender identity') + ylab('Count') +
  ggtitle('Self reported gender identity', subtitle='(Weighted)') +
  theme_classic(base_size = 25)  +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Gender.png',  g, width=10,height=7, units='in', dpi= 1200)
```

The large majority of respondents were women. This has significant implications for the generalisability of the results. Even the weighted analysis, shown here, suggests a continuing imbalance.

## Q5 Location

```{r Location}
table(VV_2$County)

g <- ggplot(data=VV_2, aes(x=County)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Location') + ylab('Count') +
  ggtitle('Approximate location of respondent') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-90, hjust=0))
g
##ggsave('images/Location.png',  g, width=10,height=7, units='in', dpi= 1200)

```

The sample covers the country widely, but is dominated by people from Dublin.

## Q6 Broadband access

```{r Broadband}
table(VV_2$Q6_1)
VV_2$Broadband <- recode(VV_2$Q6_1,
                 'Dial-up telephone line (analogue, ISDN)' = 'Dial-up',
                 "Don’t know" = "Not known") # Lose the ’
table(VV_2$Broadband)


g <- ggplot(data=VV_2 , aes(x=Broadband)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Broadband access') + ylab('Count') +
  ggtitle('Means of access to broadband internet') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-90, hjust=0))
g
##ggsave('images/Broadband.png',  g, width=10,height=7, units='in', dpi= 1200)

```

The large majority of respondents have access to broadband internet, but small number used a dial-up connection, and many used their mobile phone.

## Q7 Education

```{r Education}
table(VV_2$Education)

VV_2$Education_a <- recode(VV_2$Education,
                 'No formal education/training' = 'No formal')
VV_2$Education_a <- as_factor(VV_2$Education_a)
VV_2$Education_a <- fct_relevel(VV_2$Education_a, "No formal", "Primary education", "Secondary education", "Nat. Cert or Diploma", "Technical or Vocational", "University degree", "Postgraduate") # Desired order
table(VV_2$Education_a)

g <- ggplot(data=VV_2 , aes(x=Education_a, weight=weight)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Education level') + ylab('Count') +
  ggtitle('Highest level of education', subtitle = 'Weighted') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-70, hjust=0))
g
##ggsave('images/Education.png',  g, width=10,height=7, units='in', dpi= 1200)

```

Respondent are well educated, with 31,000 having a primary degree, and 34,00 a post-graduate degree. Again, this is quite different from the underlying population.

## Q8 Covid pandemic unemployment

```{r CovidUnemployment}
kable(table(VV_2$Q8))
kable(questionr::wtd.table(VV_2$Q8, weights= VV_2$weight,
                     digits=0,normwt=TRUE))

kable(100*round(prop.table(table(VV_2$Q8, VV_2$Education_a),2),3))
q <- questionr::wtd.table(VV_2$Q8, VV_2$Education_a, weights= VV_2$weight,
                     digits=0,normwt=TRUE)
kable(q)
kable(questionr::prop(q))

g <- ggplot(data=VV_2 , aes(x=Q8, weight = weight)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Covid Unemployment payment') + ylab('Count') +
  ggtitle('Receipt of Covid19 Unemployment support', subtitle = 'Weighted') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/CovidEnemploymentBenefit.png',  g, width=10,height=7, units='in', dpi= 1200)
```

A little under 10% of the participants are receiving COVID19 related social security benefits. Adjusted for non-participation, this rises to 14.7%. There are substantial differences between people of different education levels, with the lowest uptake in people with postgraduate degrees, and higher levels for those with less education. The uptake in those with primary school education only is low, at 7.8%, but these are an older group of people, many of whom are retired.

## Q9 Living arrangements

```{r Living arrangements}
table(VV_2$Q9)
VV_2$Q9a <- recode(VV_2$Q9,
                 'I live alone' = 'Alone',
                 'I live with other people' = 'With others')
kable(table(VV_2$Q9a))
prop.table(table(VV_2$Q9a))

kable(questionr::wtd.table(VV_2$Q9a, weights= VV_2$weight,
                     digits=0,normwt=TRUE))
prop.table(questionr::wtd.table(VV_2$Q9a, weights= VV_2$weight,
                     digits=0,normwt=TRUE))

kable(100*round(prop.table(table(VV_2$Q9a, VV_2$Education),2),3))
q <- questionr::wtd.table(VV_2$Q9a, VV_2$Education, weights= VV_2$weight,
                     digits=0,normwt=TRUE)
kable(q)
kable(questionr::prop(q))

g <- ggplot(data=VV_2 , aes(x=Q9a, weight=weight)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Living arrangements') + ylab('Count') +
  ggtitle('Do you live alone or with others?', subtitle = 'Weighted') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Live_alone.png',  g, width=10,height=7, units='in', dpi= 1200)

```

A small proportion, just over 10%, of our respondents live alone. Weighting modestly increases this

## Q83-86 Household composition
Omit for the moment

```{r Household composition, eval=FALSE}
# 4 groups Adults > 70, Adults 18-70, Children 12-17, Children < 12 or All missing

# If all missing - exclude
# There are several mad values, exceeding the Irish population, but a small number that are possible but over 200. For the moment exclude these.

HHComp <- VV_2 %>%
  select(Q83,Q84,Q85,Q86) %>%
  filter_all(all_vars(!is.na(.))) %>% # 10583 all 4 missing, 75721 not all missing
  rename('Age_71up' = 'Q83',  # Adults over 70
         'Age_18_70' = 'Q84', # Adults 18 to 70
         'Age_12_18' = 'Q85', # Children 12 to 18
         'Age_0_11' = 'Q86'   # Children under 12
         ) %>%
  select(Age_0_11, Age_12_18, Age_18_70, Age_71up)

Compositions <- HHComp %>%
  group_by_all() %>%
  summarize(count=n())

HHComp %>%
  mutate(Total = Age_71up + Age_18_70 + Age_12_17 + Age_0_11)
  
require(devtools)
# Install treemapify if not already
if(!require(treemapify)){install_github("wilkox/treemapify")}


```

Attempts to plot Household composition - not too successful!

```{r mosaic plot, eval=FALSE}
C2 <- Compositions %>%
  ungroup() %>%
  mutate_all(.funs = ~round(.,0)) %>%
  mutate(Age_Child = Age_0_11 + Age_12_17) %>%
  mutate(Age_71upc = cut(Age_71up,
                    breaks=c(0,1,2,3,100),
                    labels = c('0','1','2','3+'),
                    include.lowest = TRUE,
                    right=FALSE)) %>%
  mutate(Age_18upc = cut(Age_18_70,
                         breaks=c(0,1,2,3,100),
                         labels = c('0','1','2','3+'),
#                    breaks=c(0,1,2,3,10,20,40,60,100),
#                    labels = c('0','1','2','3+','10+','20+','40+','60+'),
                    include.lowest = TRUE,
                    right=FALSE)) %>%
  mutate(Age_12upc = cut(Age_12_17,
                         breaks=c(0,1,2,3,100),
                         labels = c('0','1','2','3+'),
                    include.lowest = TRUE,
                    right=FALSE)) %>%
  mutate(Age_0upc = cut(Age_0_11,
                         breaks=c(0,1,2,3,100),
                         labels = c('0','1','2','3+'),
                    include.lowest = TRUE,
                    right=FALSE)) %>%
  mutate(Age_Childupc = cut(Age_Child,
                         breaks=c(0,1,2,3,100),
                         labels = c('0','1','2','3+'),
                    include.lowest = TRUE,
                    right=FALSE))
  
table(C2$Age_71upc,C2$Age_71up)
table(C2$Age_71upc)
table(C2$Age_18upc)
table(C2$Age_12upc)
table(C2$Age_0upc)
table(C2$Age_Childupc)


table(C2$count)

C3 <- C2 %>%
  filter(count >100)

g <- ggplot(C3,
       aes(area=count, fill=Age_Childupc, subgroup=Age_18upc, subgroup2=Age_71upc)) +
  geom_treemap() +
  geom_treemap_subgroup_text(place = "left", grow = FALSE, alpha = 1) + geom_treemap_subgroup_border() +
  geom_treemap_subgroup2_text(place = "center", grow = FALSE, alpha = 1) + geom_treemap_subgroup2_border() 
g
##ggsave('images/HouseholdComp1.png',  g, width=10,height=7, units='in', dpi= 1200)


library(ggmosaic)
g <- ggplot(data = C3) +
  geom_mosaic(aes(weight=count, x = product(Age_71upc, Age_18upc), fill=Age_Childupc), show.legend=TRUE)
g
##ggsave('images/HouseholdComp2.png',  g, width=10,height=7, units='in', dpi= 1200)

```

## Q11 Number of people met face-to-face outside your household.

```{r face to face}
table(VV_2$Q11)
VV_2$Q11a <- recode(VV_2$Q11,
                 'None' = '0',
                 '20' = '20',
                'More than 20' = 'Over 20') %>%
  as.factor() %>%
  fct_relevel('0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','Over 20')
table(VV_2$Q11a)
round(100*prop.table(table(VV_2$Q11a)),2)
g <- ggplot(data=VV_2 , aes(x=Q11a, weight=weight)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of people') + ylab('Count') +
  ggtitle('People outside your household met face-to-face', subtitle = 'Weighted') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))

g
##ggsave('images/People_Face_to_Face.png',  g, width=10,height=7, units='in', dpi= 1200)

```

Most people met no-one (40%), or only between 1 and 3 people (another 40%) face-to-face outside their household. It's not quite clear if people counted workplace contacts when answering this question. Weighting modestly increases the number of people met outside the household

## Q13 Occupation

```{r Occupation}
table(VV_2$Q13)

VV_2 <- VV_2 %>%
  mutate(Occupation = recode(Q13,
                       'Looking after home/family' = 'Home',
                       'Working for payment or profit' = 'Employed',
                       'Student or pupil' = 'Student',
                       'Unable to work due to permanent sickness or disability' = 'Disability',
                       'Unemployed' = 'Unemployed',
                       'Retired from employment' = 'Retired',
                       'Other' = 'Other',
                       'Looking for first regular job' = 'Other'))

VV_2$Occupation <- as_factor(VV_2$Occupation) %>%
  fct_relevel(c('Employed', 'Retired', 'Home', 'Student', 'Disability', 'Unemployed', 'Other'))

table(VV_2$Occupation)
round(100*prop.table(table(VV_2$Occupation)),2)
kable(table(VV_2$Occupation))
kable(questionr::wtd.table(VV_2$Occupation, weights= VV_2$weight,
                     digits=0,normwt=TRUE))

kable(100*round(prop.table(table(VV_2$Occupation, VV_2$Education_a),2),3))
q <- questionr::wtd.table(VV_2$Occupation, 
                          VV_2$Education_a,
                          weights= VV_2$weight,
                     digits=0,normwt=TRUE)
kable(q)

g <- ggplot(data=VV_2 , aes(x=Occupation)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Type of occupation') + ylab('Count') +
  ggtitle('Reported occupation') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Occupation.png',  g, width=10,height=7, units='in', dpi= 1200)
########
g <- ggplot(data=VV_2 , aes(x=Occupation,fill=Sex)) +
  geom_bar(colour='black') +
  xlab('Type of occupation') + ylab('Count') +
  ggtitle('Reported occupation by gender') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Occupation_by_gender.png',  g, width=10,height=7, units='in', dpi= 1200)

```

A very small proportion of our sample were unemployed.This is much lower than the proportion who reported claiming the COVID19 benefit

## Q14 Q15 Q16 Working from home
Q14	Do you usually work from home?
Q15	Before the Covid-19 crisis, how often did you usually work from home ?
Q16	If you never worked from home before the outbreak of the COVID-19 crisis, what was the reason? - Selected Choice
Q16_5_TEXT	If you never worked from home before the outbreak of the COVID-19 crisis, what was the reason? - Other - Text

```{r Working from home}
# Usually
table(VV_2$Q14)
# Before COVID19
table(VV_2$Q15)
table(VV_2$Q14,VV_2$Q15, useNA='ifany') # Adds up to the Sometimes of Q14

table(VV_2$Q16) # Adds up to the Never of Q14
table(VV_2$Q14, VV_2$Q16)

VV_2 %>% select(Q16_5_TEXT) %>% filter(!is.na(Q16_5_TEXT)) %>% arrange(Q16_5_TEXT) # Useful range of comments!

```

# Q17 18 19 Usual work and work in last week
There are three questions about usual work and work situation in the last week

```{r Work}

table(VV_2$Q17) # Current Employment

table(VV_2$Q18) # Sector of epmployment
table(VV_2$Q19) # Last week
```

Q17 Do you work as an employee or are you self-employed in your main job?(Your main job is the job in which you usually work the most hours)

```{r Employment Type}
#Current employment 

VV_2 = VV_2 %>% mutate(Q17a = recode(Q17,
                              "Employee" = "1",
                              "Self-employed, without paid employees" = "2",
                              "Self-employed, with paid employees" = "3",
                              "Assisting relative (not receiving a fixed wage or salary)" = "4",
                              .default = NA_character_))

VV_2 %>% select(Q17a) %>% group_by(Q17a) %>%
  filter(!is.na(Q17a)) %>% summarise(N = n()) %>%
  mutate(Pct = round(100*N/sum(N),2)) %>%
  kable()
```

Q18 Which sector does the company or organisation you work for belong to ?

```{r Employment Sector}
# Empoyment sector
table(VV_2$Q18)
VV_2 %>% select(Q18, Weights) %>% group_by(Q18) %>%
  filter(!is.na(Q18)) %>% summarise(N = n()) %>%
  mutate(Pct = round(100*N/sum(N),2)) %>%
  arrange(desc(Pct)) %>%
  kable(caption='Sectoral Employment - Unweighted')
VV_2 %>% select(Q18, Weights) %>% group_by(Q18) %>%
  filter(!is.na(Q18)) %>% summarise(N = sum(Weights)) %>%
  mutate(Pct = round(100*N/sum(N),2)) %>%
  arrange(desc(Pct)) %>%
  kable(caption='Sectoral Employment - Weighted')
```

Q19 Over the past week, in relation to your work, have you:
"worked from home", "worked onsite as essential worker", "worked onsite but non-essential worker", "not working as I am (temporarily) laid off", "not working due to other reasons", "Education" , "Arts, entertainment and recreation",
"Industry not stated", "other"

```{r}
################
#Q19

sort(unique(VV_2$Q19))[!str_detect(sort(unique(VV_2$Q19)),",")]

VV_2 <- VV_2 %>%
  mutate(Q19a = str_replace_all(Q19,
                       c("worked from home" = "1",
                         "worked onsite as essential worker" = "2",
                         "worked onsite but non-essential worker" = "3",
                         "not working as I am \\(temporarily\\) laid off" = "4",
                         "not working due to other reasons" = "5",
                         "Education" = "6",
                         "Arts, entertainment and recreation" = "6",
                         "Industry not stated" = "6",
                         "other" = "6",
                         .default = NA_character_)
                       ))

sort(unique(VV_2$Q19a))[!str_detect(sort(unique(VV_2$Q19a)),",")]
sort(unique(VV_2$Q19a))[str_detect(sort(unique(VV_2$Q19a)),",")]

VV_2 <- VV_2 %>%
  mutate(Q19a_1 = str_detect(Q19a,'1')) %>%
  mutate(Q19a_2 = str_detect(Q19a,'2')) %>%
  mutate(Q19a_3 = str_detect(Q19a,'3')) %>%
  mutate(Q19a_4 = str_detect(Q19a,'4')) %>%
  mutate(Q19a_5 = str_detect(Q19a,'5')) %>%
  mutate(Q19a_6 = str_detect(Q19a,'6')) %>%
  mutate(Q19a_7 = str_detect(Q19a,'7')) %>%
  mutate_if(is.logical,as.numeric) # Makes 1 and 0

table(VV_2$Q19a_1)
table(VV_2$Q19a_2)
table(VV_2$Q19a_3)
table(VV_2$Q19a_4)
table(VV_2$Q19a_5)
table(VV_2$Q19a_6)
table(VV_2$Q19a,VV_2$Q19a_2)

Last_Week <- VV_2 %>%
  select(ResponseId,Weights,Q17a,Q19a_1,Q19a_2,Q19a_3,Q19a_4,
         Q19a_5,Q19a_6) %>%
  rename('Work - Home' = Q19a_1, 'Work - Essential' = Q19a_2,
         'Work - Non-Essential' = Q19a_3, 'Laid off' = Q19a_4, 'Not working other' = Q19a_5,
         'Other' = Q19a_6) %>%
#  c("worked from home" = "1",
#                         "worked onsite as essential worker" = "2",
#                         "worked onsite but non-essential worker" = "3",
#                         "not working as I am \\(temporarily\\) laid off" = "4",
#                         "not working due to other reasons" = "5",
#                         "Education" = "6",
#                         "Arts, entertainment and recreation" = "6",
#                         "Industry not stated" = "6",
#                         "other" = "6",
  pivot_longer(-c(ResponseId, Weights, Q17a), names_to='Working', values_to='Count') %>%
  filter(!is.na(Q17a))
#%>%
#  mutate_all(~replace(., is.na(.), 0))

Last_Week_ResponseId <- Last_Week %>% group_by(Weights,ResponseId) %>%
  summarise(N=sum(Count))  %>% # Number of things done by each person 1 -3
  mutate(Adjusted_Weights = Weights/N)
table(Last_Week_ResponseId$N)

g <- ggplot(Last_Week_ResponseId, aes(x=N)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of workplaces per person') + ylab('Count') +
  ggtitle('Reported workplace in last week') +
  theme_classic(base_size = 25) 
g
##ggsave('images/Workplace_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)

Last_Week_Activity <- Last_Week %>% group_by(Working) %>% 
  summarise(N=sum(Count)) %>% filter(N > 0) %>% arrange(desc(N))  %>%
  mutate(Working_f = fct_infreq(as_factor(Working)))

g <- ggplot(Last_Week_Activity, aes(x=Working_f, y=N)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Type of workplace') + ylab('Count') +
  ggtitle('Number of people at each workplace') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Workplace_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

```

The majority of those working are Employees. 1 in 4 respondents worked in education, 15% in Health and social work, 9% in Professional, Scientific and Technical, and 8% in Finance. This is quite skewed compared to the underlying population. Weighting produces figures closer to the underlying population.

## Q20 Why not working from home?

If you cannot work from home currently, what is the reason (multiple answers possible):

```{r}
table(VV_2$Q20)

sort(unique(VV_2$Q20))[!str_detect(sort(unique(VV_2$Q20)),",")]

VV_2 <- VV_2 %>%
  mutate(Q20a = str_replace_all(Q20,
                                c("Because childcare is not available" = "1",
                                "I am an essential worker" = "2",
                                "I do not have access to all the information needed to work from home" = "3",
                                "I don't want to work from home" = "4",
                                "My internet connection is not reliable enough" = "5",
                                "My job doesn't lend itself to teleworking" = "6",
                                "My job involves necessary face-to-face contact with colleagues/clients" = "7",
                                "My supervisor does not allow me to work from home" = "8",
                                "worked from home" = "9",
                                "Working from home is not allowed in my company/organisation" = "10",
                                "I don't have the necessary resources \\(laptop, workplace\\) to work from home" = "11", # Quote the ( and )
                                .default = NA_character_)
                                ))
sort(unique(VV_2$Q20a))[!str_detect(sort(unique(VV_2$Q20a)),",")]
sort(unique(VV_2$Q20a))[str_detect(sort(unique(VV_2$Q20a)),",")]

VV_2 <- VV_2 %>%
  mutate(Q20a_1 = str_detect(Q20a,'1')) %>%
  mutate(Q20a_2 = str_detect(Q20a,'2')) %>%
  mutate(Q20a_3 = str_detect(Q20a,'3')) %>%
  mutate(Q20a_4 = str_detect(Q20a,'4')) %>%
  mutate(Q20a_5 = str_detect(Q20a,'5')) %>%
  mutate(Q20a_6 = str_detect(Q20a,'6')) %>%
  mutate(Q20a_7 = str_detect(Q20a,'7')) %>%
  mutate(Q20a_8 = str_detect(Q20a,'8')) %>%
  mutate(Q20a_9 = str_detect(Q20a,'9')) %>%
  mutate(Q20a_10 = str_detect(Q20a,'10')) %>%
  mutate(Q20a_11 = str_detect(Q20a,'11')) %>%
  mutate_if(is.logical,as.numeric) # Makes 1 and 0

table(VV_2$Q20a_1)
table(VV_2$Q20a_2)
table(VV_2$Q20a_3)
table(VV_2$Q20a_4)
table(VV_2$Q20a_5)
table(VV_2$Q20a_6)
table(VV_2$Q20a_7)
table(VV_2$Q20a_8) # Almost none
table(VV_2$Q20a_9) # Almost none
table(VV_2$Q20a_10)
table(VV_2$Q20a_11)
table(VV_2$Q20a,VV_2$Q20a_2)

Why_Not <- VV_2 %>%
  select(ResponseId,Weights,Q20a,Q20a_1,Q20a_2,Q20a_3,Q20a_4,
         Q20a_5,Q20a_6,Q20a_7,Q20a_8,Q20a_9,Q20a_10,Q20a_11) %>%
  rename('No childcare' = Q20a_1, 'Essential worker' = Q20a_2, 'Information' = Q20a_3,
         "Don't want to" = Q20a_4, 'Internet' = Q20a_5, 'Job type' = Q20a_6,
         "Job face" = Q20a_7, 'Supervisor' = Q20a_8, 'Home worker' = Q20a_9,
         "Not allowed" = Q20a_10, "Resources" = Q20a_11) %>%
#                                c("Because childcare is not available" = "1",
#                                "I am an essential worker" = "2",
#                                "I do not have access to all the information needed to work from home" = "3",
#                                "I don't want to work from home" = "4",
#                                "My internet connection is not reliable enough" = "5",
#                                "My job doesn't lend itself to teleworking" = "6",
#                                "My job involves necessary face-to-face contact with colleagues/clients" = "7",
#                                "My supervisor does not allow me to work from home" = "8",
#                                "worked from home" = "9",
#                                "Working from home is not allowed in my company/organisation" = "10",
#                                "I don't have the necessary resources \\(laptop, workplace\\) to work from home" = "11", # Quote the ( and )
#
  pivot_longer(-c(ResponseId, Weights, Q20a), names_to='Working', values_to='Count') %>%
  filter(!is.na(Q20a))


Why_Not_ResponseId <- Why_Not %>% group_by(Weights,ResponseId) %>%
  summarise(N=sum(Count))  %>% # Number of reasons given by each person 1 -3
  mutate(Adjusted_Weights = Weights/N)
table(Why_Not_ResponseId$N)

g <- ggplot(Why_Not_ResponseId, aes(x=N)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of reasons per person') + ylab('Count') +
  scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,10)) +
  ggtitle('Reasons for not home working') +
  theme_classic(base_size = 25) 
g
##ggsave('images/Why_not_home_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)

Why_Not_Activity <- Why_Not %>% group_by(Working) %>% 
  summarise(N=sum(Count)) %>% filter(N > 0) %>% arrange(desc(N))  %>%
  mutate(Working_f = fct_infreq(as_factor(Working)))

g <- ggplot(Why_Not_Activity, aes(x=Working_f, y=N)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Reason given') + ylab('Count') +
  ggtitle('Reasons for not home working') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Why_not_home_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

```

# Children and childcare

## Q22 Children under the age of 17

Question not asked in Round 2


## 87 - 92 Number and age groups of children
Q87	How many children in your household are in preschool/childcare?
Q88	How many children in your household are attending primary school?
Q90	How many children younger than 15 in your household are attending secondary school?
Q92	How many children over the age of 15 in your household are attending secondary school?


```{r Cleanup and count children}
table(VV_2$Q87)
VV_2 <- VV_2 %>%
  mutate(Preschool = recode(Q87,
         "None" = "0",
         "1" = "1", "2" = "2", "3" = "3",
         "More than 3" = "4+",
         .default  = NA_character_
         ))

VV_2 <- VV_2 %>%
  mutate(Primary = recode(Q88,
         "None" = "0",
         "1" = "1", "2" = "2", "3" = "3",
         "More than 3" = "4+",
         .default  = NA_character_
         ))

VV_2 <- VV_2 %>%
  mutate(Lower_Secondary = recode(Q90,
         "None" = "0",
         "1" = "1", "2" = "2", "3" = "3",
         "More than 3" = "4+",
         .default  = NA_character_
         ))

VV_2 <- VV_2 %>%
  mutate(Upper_Secondary = recode(Q92,
         "None" = "0",
         "1" = "1", "2" = "2", "3" = "3",
         "More than 3" = "4+",
         .default  = NA_character_
         ))

table(VV_2$Q87, useNA = 'ifany') # Preschool
table(VV_2$Preschool, useNA = 'ifany')

table(VV_2$Q88, useNA = 'ifany') # Primary
table(VV_2$Primary, useNA = 'ifany')

table(VV_2$Q90, useNA = 'ifany') # Lower secondary
table(VV_2$Lower_Secondary, useNA = 'ifany')

table(VV_2$Q92, useNA = 'ifany') # Upper secondary
table(VV_2$Upper_Secondary, useNA = 'ifany')

```

```{r Report on childen}

Children <- VV_2 %>%
  select(ResponseId,Preschool, Primary, Lower_Secondary, Upper_Secondary) %>%
  mutate_all(~replace(., is.na(.), 0)) %>%
  mutate_at(c("Preschool", "Primary", "Lower_Secondary", "Upper_Secondary"), as.numeric) %>%
  mutate(Total = Preschool + Primary + Lower_Secondary + Upper_Secondary ) %>%
  pivot_longer(-c(ResponseId,Total), names_to = 'Children', values_to = 'Number') %>%
  mutate(Children = factor(Children,
                              levels=c("Preschool","Primary", "Lower_Secondary", "Upper_Secondary")))

g <- ggplot(Children, aes(x=Number)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of children') + ylab('Count') +
  scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7,8,10)) +
  ggtitle('Reported children per family') +
  theme_classic(base_size = 25)  +
  facet_wrap(~Children)

g
```

## Q24 Childcare arrangements for pre-school children

Q24 IF CHILDREN in preschool AT HOME How did you arrange childcare since the closing of schools/childcare

```{r Childcare for preschoolers}
table(VV_2$Q24)
sort(unique(VV_2$Q24))[!str_detect(sort(unique(VV_2$Q24)),",")]

VV_2 <- VV_2 %>%
  mutate(Q24a = str_replace_all(Q24,
                       c("Just at home" = "1", "Childminder" = "2",
                       "With grandparents" = "3",
                       "With family \\(not grandparents\\)" = "4",
                       "With ex-partner" = "5", "With friends/acquaintances" = "6",
                       "Other" = "7")
                       )) %>%
  mutate(Q24a = str_replace_all(Q24a,c(" " = '')))

sort(unique(VV_2$Q24a))[!str_detect(sort(unique(VV_2$Q24a)),",")]
sort(unique(VV_2$Q24a))[str_detect(sort(unique(VV_2$Q24a)),",")]

VV_2 <- VV_2 %>%
  mutate(Q24a_1 = str_detect(Q24a,'1')) %>%
  mutate(Q24a_2 = str_detect(Q24a,'2')) %>%
  mutate(Q24a_3 = str_detect(Q24a,'3')) %>%
  mutate(Q24a_4 = str_detect(Q24a,'4')) %>%
  mutate(Q24a_5 = str_detect(Q24a,'5')) %>%
  mutate(Q24a_6 = str_detect(Q24a,'6')) %>%
  mutate(Q24a_7 = str_detect(Q24a,'7'))
  
table(VV_2$Q24a_1)
table(VV_2$Q24a_2)
table(VV_2$Q24a_3)
table(VV_2$Q24a_4)
table(VV_2$Q24a_5)
table(VV_2$Q24a_6)
table(VV_2$Q24a_7)
table(VV_2$Q24a,VV_2$Q24a_2)

Childcare <- VV_2 %>%
  select(ResponseId,Preschool,Q24a_1,Q24a_2,Q24a_3,Q24a_4,
         Q24a_5,Q24a_6,Q24a_7) %>%
  rename('At home' = Q24a_1, 'Childminder' = Q24a_2,
         'Grandparents' = Q24a_3, 'Other family' = Q24a_4, 'Ex-partner' = Q24a_5,
         'Friends' = Q24a_6, 'Other' = Q24a_7) %>%
  pivot_longer(-c(ResponseId, Preschool), names_to='Childcare', values_to='count') %>%
  filter(!is.na(Preschool)) %>%
  filter(Preschool > 0) %>%
  mutate(count = as.numeric(count)) %>%
  mutate_all(~replace(., is.na(.), 0))

Childcare_ResponseId <- Childcare %>% group_by(ResponseId) %>%
  summarise(n=sum(count))

Childcare_Source <- Childcare %>% group_by(Childcare) %>%
  summarise(n=sum(count))

g <- ggplot(Childcare_ResponseId, aes(x=n)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of types of childcare used') + ylab('Count') +
  ggtitle('Reported sources of childcare') +
  scale_x_binned(breaks=c(0,1,2,3,4,5,6)) +
  theme_classic(base_size = 25) 
g
##ggsave('images/Childcare_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)


g <- ggplot(Childcare_Source, aes(x=Childcare, y=n)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Source of childcare') + ylab('Count') +
  ggtitle('Number of people using each source of childcare') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Childcare_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

```

# Schooling and related matters

### Q89 Primary School
Q89	What were the biggest obstacles in relation to the school work of your primary school child(ren)? (multiple answers possible)

```{r Q89 Primary}

sort(unique(VV_2$Q89))[!str_detect(sort(unique(VV_2$Q89)),",")] # Components of answer

VV_2 <- VV_2 %>%
  mutate(Q89a = str_replace_all(Q89,
                  c("Lack of clarity about what I had to do as a parent" = "1",
                    "Motivation of child\\(ren\\)" = "2",
                    "My other children" = "3",
                    "My work at home \\(working from home\\)" = "4",
                    "My work outside of home" = "5",
                    "No obstacles" = "6",
                    "Resources \\(Laptop, access to computer, internet…\\)" = "7",
                    "Other" = "8",
                    .default = NA_character_)
                  ))

sort(unique(VV_2$Q89a))[str_detect(sort(unique(VV_2$Q89a)),",")] # Components of answer

                         
table(VV_2$Q89a, useNA = 'ifany')

VV_2 <- VV_2 %>%
  mutate(Q89a_1 = str_detect(Q89a,'1')) %>%
  mutate(Q89a_2 = str_detect(Q89a,'2')) %>%
  mutate(Q89a_3 = str_detect(Q89a,'3')) %>%
  mutate(Q89a_4 = str_detect(Q89a,'4')) %>%
  mutate(Q89a_5 = str_detect(Q89a,'5')) %>%
  mutate(Q89a_6 = str_detect(Q89a,'6')) %>%
  mutate(Q89a_7 = str_detect(Q89a,'7')) %>%
  mutate(Q89a_8 = str_detect(Q89a,'8')) %>%
  mutate_if(is.logical,as.numeric)
  

table(VV_2$Q89a_1)
table(VV_2$Q89a_2)
table(VV_2$Q89a_3)
table(VV_2$Q89a_4)
table(VV_2$Q89a_5)
table(VV_2$Q89a_6)
table(VV_2$Q89a_7)
table(VV_2$Q89a_8)
table(VV_2$Q89a,VV_2$Q89a_2)

Motivation_P <- VV_2 %>%
  select(ResponseId,Q89a_1,Q89a_2,Q89a_3,Q89a_4,
         Q89a_5,Q89a_6,Q89a_7,Q89a_8) %>%
  rename('Clarity' = Q89a_1, 'Motivation' = Q89a_2,
         'Other Children' = Q89a_3, 'Work at home' = Q89a_4,
         'Work away' = Q89a_5, 'None' = Q89a_6,
         'Resources' = Q89a_7, 'Other' = Q89a_8) %>%
  pivot_longer(-ResponseId, names_to='Obstacle', values_to='Count') %>%
  mutate(Count = as.numeric(Count)) %>%
  mutate_all(~replace(., is.na(.), 0))

Motivation_P_ResponseId <- Motivation_P %>% group_by(ResponseId) %>%
  summarise(N=sum(Count))
Motivation_P_ResponseId %>% group_by(N) %>% summarise(Sum = sum(N))

g <- ggplot(Motivation_P_ResponseId, aes(x=N)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of obstacles') + ylab('Count') +
  scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7)) +
  ggtitle('Reported obstacles for school work',
          subtitle='Primary school') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Obstacles_Primary_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)

Motivation_P_Obstacle <- Motivation_P %>% group_by(Obstacle) %>%
  summarise(Count=sum(Count)) %>%
  mutate(Obstacle = as_factor(Obstacle)) %>%
  mutate(Obstacle = fct_relevel(Obstacle, 'Motivation', 'Work at home',
                            'Other Children', 'Clarity', 'Resources',
                            'None', 'Work away', 'Other'))
  

g <- ggplot(Motivation_P_Obstacle, aes(x=Obstacle, y=Count)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Obstacles') + ylab('Count') +
 ggtitle('Reported obstacles for school work',
          subtitle='Primary school') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Obstacles_Primary_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

rm(Motivation_P_Obstacle, Motivation_P_ResponseId)

```

### Q91 Lower secondary 
Q91	What were the biggest obstacles in relation to the school work of your child(ren) under 15 in secondary school? (multiple answers possible)

```{r Q91 Lower secondary}

sort(unique(VV_2$Q91))[!str_detect(sort(unique(VV_2$Q91)),",")] # Components of answer

VV_2 <- VV_2 %>%
  mutate(Q91a = str_replace_all(Q91,
                  c("Lack of clarity about what I had to do as a parent" = "1",
                    "Motivation of child\\(ren\\)" = "2",
                    "My other children" = "3",
                    "My work at home \\(working from home\\)" = "4",
                    "My work outside of home" = "5",
                    "No obstacles" = "6",
                    "Resources \\(Laptop, access to computer, internet…\\)" = "7",
                    "Other" = "8",
                    .default = NA_character_)
                  ))

sort(unique(VV_2$Q91a))[str_detect(sort(unique(VV_2$Q91a)),",")] # Components of answer

                         
table(VV_2$Q91a, useNA = 'ifany')

VV_2 <- VV_2 %>%
  mutate(Q91a_1 = str_detect(Q91a,'1')) %>%
  mutate(Q91a_2 = str_detect(Q91a,'2')) %>%
  mutate(Q91a_3 = str_detect(Q91a,'3')) %>%
  mutate(Q91a_4 = str_detect(Q91a,'4')) %>%
  mutate(Q91a_5 = str_detect(Q91a,'5')) %>%
  mutate(Q91a_6 = str_detect(Q91a,'6')) %>%
  mutate(Q91a_7 = str_detect(Q91a,'7')) %>%
  mutate(Q91a_8 = str_detect(Q91a,'8')) %>%
  mutate_if(is.logical,as.numeric)
  

table(VV_2$Q91a_1)
table(VV_2$Q91a_2)
table(VV_2$Q91a_3)
table(VV_2$Q91a_4)
table(VV_2$Q91a_5)
table(VV_2$Q91a_6)
table(VV_2$Q91a_7)
table(VV_2$Q91a_8)
table(VV_2$Q91a,VV_2$Q91a_2)

Motivation_L <- VV_2 %>%
  select(ResponseId,Q91a_1,Q91a_2,Q91a_3,Q91a_4,
         Q91a_5,Q91a_6,Q91a_7,Q91a_8) %>%
  rename('Clarity' = Q91a_1, 'Motivation' = Q91a_2,
         'Other Children' = Q91a_3, 'Work at home' = Q91a_4,
         'Work away' = Q91a_5, 'None' = Q91a_6,
         'Resources' = Q91a_7, 'Other' = Q91a_8) %>%
  pivot_longer(-ResponseId, names_to='Obstacle', values_to='Count') %>%
  mutate(Count = as.numeric(Count)) %>%
  mutate_all(~replace(., is.na(.), 0))

Motivation_L_ResponseId <- Motivation_L %>% group_by(ResponseId) %>%
  summarise(N=sum(Count))
Motivation_L_ResponseId %>% group_by(N) %>% summarise(Sum = sum(N))

g <- ggplot(Motivation_L_ResponseId, aes(x=N)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of obstacles') + ylab('Count') +
  scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7)) +
  ggtitle('Reported obstacles for school work',
          subtitle='Lower secondary school') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Obstacles_Lower_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)

Motivation_L_Obstacle <- Motivation_L %>% group_by(Obstacle) %>%
  summarise(Count=sum(Count)) %>%
  mutate(Obstacle = as_factor(Obstacle)) %>%
  mutate(Obstacle = fct_relevel(Obstacle, 'Motivation', 'Work at home',
                            'Other Children', 'Clarity', 'Resources',
                            'None', 'Work away', 'Other'))
  

g <- ggplot(Motivation_L_Obstacle, aes(x=Obstacle, y=Count)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Obstacles') + ylab('Count') +
 ggtitle('Reported obstacles for school work',
          subtitle='Lower secondary school') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Obstacles_Lower_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

rm(Motivation_L_Obstacle, Motivation_L_ResponseId)
```

### Q30 Upper secondary 
Q93	What were the biggest obstacles in relation to the school work of your child(ren) over the age of 15 in secondary school? (multiple answers possible)

```{r Q93 Upper secondary}

sort(unique(VV_2$Q93))[!str_detect(sort(unique(VV_2$Q93)),",")] # Components of answer

VV_2 <- VV_2 %>%
  mutate(Q93a = str_replace_all(Q93,
                  c("Lack of clarity about what I had to do as a parent" = "1",
                    "Motivation of child\\(ren\\)" = "2",
                    "My other children" = "3",
                    "My work at home \\(working from home\\)" = "4",
                    "My work outside of home" = "5",
                    "No obstacles" = "6",
                    "Resources \\(Laptop, access to computer, internet…\\)" = "7",
                    "Other" = "8",
                    .default = NA_character_)
                  ))

sort(unique(VV_2$Q93a))[str_detect(sort(unique(VV_2$Q93a)),",")] # Components of answer

                         
table(VV_2$Q93a, useNA = 'ifany')

VV_2 <- VV_2 %>%
  mutate(Q93a_1 = str_detect(Q93a,'1')) %>%
  mutate(Q93a_2 = str_detect(Q93a,'2')) %>%
  mutate(Q93a_3 = str_detect(Q93a,'3')) %>%
  mutate(Q93a_4 = str_detect(Q93a,'4')) %>%
  mutate(Q93a_5 = str_detect(Q93a,'5')) %>%
  mutate(Q93a_6 = str_detect(Q93a,'6')) %>%
  mutate(Q93a_7 = str_detect(Q93a,'7')) %>%
  mutate(Q93a_8 = str_detect(Q93a,'8')) %>%
  mutate_if(is.logical,as.numeric)
  

table(VV_2$Q93a_1)
table(VV_2$Q93a_2)
table(VV_2$Q93a_3)
table(VV_2$Q93a_4)
table(VV_2$Q93a_5)
table(VV_2$Q93a_6)
table(VV_2$Q93a_7)
table(VV_2$Q93a_8)
table(VV_2$Q93a,VV_2$Q93a_2)

Motivation_U <- VV_2 %>%
  select(ResponseId,Q93a_1,Q93a_2,Q93a_3,Q93a_4,
         Q93a_5,Q93a_6,Q93a_7,Q93a_8) %>%
  rename('Clarity' = Q93a_1, 'Motivation' = Q93a_2,
         'Other Children' = Q93a_3, 'Work at home' = Q93a_4,
         'Work away' = Q93a_5, 'None' = Q93a_6,
         'Resources' = Q93a_7, 'Other' = Q93a_8) %>%
  pivot_longer(-ResponseId, names_to='Obstacle', values_to='Count') %>%
  mutate(Count = as.numeric(Count)) %>%
  mutate_all(~replace(., is.na(.), 0))

Motivation_U_ResponseId <- Motivation_U %>% group_by(ResponseId) %>%
  summarise(N=sum(Count))
Motivation_U_ResponseId %>% group_by(N) %>% summarise(Sum = sum(N))

g <- ggplot(Motivation_U_ResponseId, aes(x=N)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of obstacles') + ylab('Count') +
  scale_x_continuous(breaks=c(0,1,2,3,4,5,6,7)) +
  ggtitle('Reported obstacles for school work',
          subtitle='Primary school') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Obstacles_Upper_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)

Motivation_U_Obstacle <- Motivation_U %>% group_by(Obstacle) %>%
  summarise(Count=sum(Count)) %>%
  mutate(Obstacle = as_factor(Obstacle)) %>%
  mutate(Obstacle = fct_relevel(Obstacle, 'Motivation', 'Work at home',
                            'Other Children', 'Clarity', 'Resources',
                            'None', 'Work away', 'Other'))
  

g <- ggplot(Motivation_U_Obstacle, aes(x=Obstacle, y=Count)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Obstacles') + ylab('Count') +
 ggtitle('Reported obstacles for school work',
          subtitle='Upper secondary school') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Obstacles_Upper__totals.png',  g, width=10,height=7, units='in', dpi= 1200)

rm(Motivation_U_Obstacle, Motivation_U_ResponseId)
```

## Pooled curriculum problems

```{r Pooled schooling problems}

Motivation_P <- Motivation_P %>% mutate(School = 'Primary')
Motivation_L <- Motivation_L %>% mutate(School = 'Lower secondary')
Motivation_U <- Motivation_U %>% mutate(School = 'Upper secondary')

Motivation = rbind(Motivation_P, Motivation_L, Motivation_U)

Motivation_Obstacle <- Motivation %>% group_by(School,Obstacle) %>%
  summarise(Count=sum(Count)) %>%
  ungroup() %>%
  mutate(Obstacle = as_factor(Obstacle)) %>%
  mutate(Obstacle = fct_relevel(Obstacle, 'Motivation', 'Work at home',
                            'Other Children', 'Clarity', 'Resources',
                            'None', 'Work away', 'Other')) %>%
  mutate(School = as_factor(School)) %>%
  mutate(School = fct_relevel(School, "Primary",
                              "Lower secondary","Upper secondary"))
  

g <- ggplot(Motivation_Obstacle, aes(x=Obstacle, y=Count)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Obstacles') + ylab('Count') +
 ggtitle('Reported obstacles for school work',
          subtitle='By school type') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0)) +
  theme(strip.text = element_text(size=15)) +
  coord_flip() +
  facet_wrap(~School)
g
##ggsave('images/Obstacles_Upper__totals.png',  g, width=10,height=7, units='in', dpi= 1200)


rm(Motivation,Motivation_P, Motivation_L, Motivation_U, Motivation_Obstacle)

```

Maintaining the motivation of their children was a significant problem for the parents of children in all three age groups. The proportion reporting no problems rose with older children. Working at home was reported as much more of an obstacle with younger children.

## Q25 Q27 Q29 Continuing the curriculum


## Q31 Leaving certificate
Q31 Are you or your children currently doing the Leaving Cert?

```{r Leaving cert}

VV_2 %>% select(Q31) %>%
  filter(!is.na(Q31)) %>%
  group_by(Q31) %>%
  summarise(N = n()) %>%
  mutate(Pct = round(100*N/sum(N),2)) %>% kable(caption = "Are you or your child doing the Leaving Cert?")

```

# Cocooning and care

## Q94 Cocooning

Q94	Are you currently cocooning?

```{r Cocooning}
VV_2 %>% select(Q94) %>%
  filter(!is.na(Q94)) %>%
  group_by(Q94) %>%
  summarise(N = n()) %>%
  mutate(Pct = round(100*N/sum(N),2)) %>% kable(caption = "Are you currently cocooning?")

```


Q95	Since the outbreak of COVID-19, have you taken on extra responsibilities to look after someone considered to be vulnerable?

```{r Care}
VV_2 %>% select(Q95) %>%
  filter(!is.na(Q95)) %>%
  group_by(Q95) %>%
  summarise(N = n()) %>%
  mutate(Pct = round(100*N/sum(N),2)) %>% kable(caption = "Have you extra caring responsibilities now?")

```

# Symptoms

## Q32 Flu like symptoms

Have you had flu-like symptoms in the last 14 days?

```{r Q32 Flu like symptoms}
VV_2 %>% select(Q32) %>% group_by(Q32) %>% summarise(N=n()) %>% mutate(Pct = round(100*N/sum(N),2)) %>% kable(caption= 'Flu like symptoms in the last fortnight (Self).')
```

Just under 3.5% of our sample reported flu-like symptoms over the last fortnight.

## Q36	COVID19 symptoms?
Do you think you had symptoms of CORONA?

```{r Q36 Covid?}
VV_2 = VV_2 %>% mutate(Q36a = recode(Q36,
                              "No" = "No",
                              "Yes" = "Yes",
                              .default = NA_character_)) %>% # Character
  mutate(Q36b = as.numeric(recode(Q36a, "No" = "0", "Yes" = "1"))) %>% # Numeric
  mutate(Q36c = fct_infreq(as_factor(Q36a))) # Factor in right order

VV_2 %>% select(Q36a) %>%
  group_by(Q36a) %>% filter(!is.na(Q36a)) %>%
  summarise(N=n()) %>% mutate(Pct = round(100*N/sum(N),2)) %>%
  kable(caption= 'Did you think this was COVID19?')
```

Of those, just under half felt that these symptoms were, or might be, COVID19.

## Q37	Professional contact
Did you contact a healthcare professional about your symptoms?

```{r Q37 contact}
VV_2 = VV_2 %>% mutate(Q37a = recode(Q37,
                              "Yes, GP" = "Own GP",
                              "No" = "None",
                              "Yes, contacted HSE for Advice" = "HSE",
                              "Other" = "Other",
                              "Yes, Out of hours GP" = "GP on call",
                              .default = NA_character_)) %>%
  mutate(Q37a = fct_infreq(as_factor(Q37a))) %>%
  mutate(Q37b = recode(Q37a,
                       "Own GP" = 1,
                       "None" = 0,
                       "HSE" = 1,
                       "Other" = 1,
                       "GP on call" = 1))

VV_2 %>% select(Q37a) %>%
  group_by(Q37a) %>% filter(!is.na(Q37a)) %>%
  summarise(N=n()) %>% mutate(Pct = round(100*N/sum(N),2)) %>%
  kable(caption= 'Did you get advice from a health professional?')


chisq.test(VV_2$Q36a,VV_2$Q37a)
chisq.test(VV_2$Q36b,VV_2$Q37b)

CrossTable(VV_2$Q37a,VV_2$Q36a,chisq=TRUE,prop.r=FALSE,prop.c=FALSE,prop.t = FALSE,prop.chisq = FALSE,digits=2)
CrossTable(VV_2$Q37b,VV_2$Q36b,chisq=TRUE,prop.r=FALSE,prop.c=FALSE,prop.t = FALSE,prop.chisq = FALSE,digits=2)

Model <- glm(Q36b ~ Q37b, data=VV_2, family='binomial')
Estimates <- broom::tidy(Model,conf.int=TRUE) %>%
 mutate(OR=exp(estimate), LRCI=exp(conf.low),UPCI=exp(conf.high))

```

People who thought they had symptoms of COVID19 were 6.1 (95%CI 4.7 to 7.9) times more likely more likely to contact a health care professional than those who did not (Chi^2=1063.069, d.f.=4, p=8e-229).

## Q33	Please indicate which symptoms you have had:

```{r Q33 Whch symptoms}
sort(unique(VV_2$Q33))[!str_detect(sort(unique(VV_2$Q33)),",")]
sort(unique(VV_2$Q33))[str_detect(sort(unique(VV_2$Q33)),"Nausea")]


VV_2 <- VV_2 %>%
  mutate(Q33a = str_replace_all(Q33,
                       c("Chest pain" = "1",
                         "High fever \\(over 38°\\)" = "2",
                         "Muscle pain" = "3",
                         "Rapidly rising fever" = "4",
                         "Runny nose" = "5", "Shivers" = "6",
                         "Shortness of breath" = "7",
                         "Sore eyes" = "8", "Sore throat" = "9",
                         "Other" = "10", "Dry, throaty cough" = "11",
                         "Rattly, chesty cough" = "12", 
                         "Tired, exhausted" = "13",
                         "Nausea, vomiting" = "14",
                         "Diarrhoea" = "15",
                         "Loss of taste/appetite" = "16",
                         "Loss of smell" = "17",
                         "No" = NA_character_,
                         .default = NA_character_)
                       ))

VV_2 <- VV_2 %>%
  mutate(Q33a_1 = str_detect(Q33a,'1')) %>%
  mutate(Q33a_2 = str_detect(Q33a,'2')) %>%
  mutate(Q33a_3 = str_detect(Q33a,'3')) %>%
  mutate(Q33a_4 = str_detect(Q33a,'4')) %>%
  mutate(Q33a_5 = str_detect(Q33a,'5')) %>%
  mutate(Q33a_6 = str_detect(Q33a,'6')) %>%
  mutate(Q33a_7 = str_detect(Q33a,'7')) %>%
  mutate(Q33a_8 = str_detect(Q33a,'8')) %>%
  mutate(Q33a_9 = str_detect(Q33a,'9')) %>%
  mutate(Q33a_10 = str_detect(Q33a,'10')) %>%
  mutate(Q33a_11 = str_detect(Q33a,'11')) %>%
  mutate(Q33a_12 = str_detect(Q33a,'12')) %>%
  mutate(Q33a_13 = str_detect(Q33a,'13')) %>%
  mutate(Q33a_14 = str_detect(Q33a,'14')) %>%
  mutate(Q33a_15 = str_detect(Q33a,'15')) %>%
  mutate(Q33a_16 = str_detect(Q33a,'16')) %>%
  mutate(Q33a_17 = str_detect(Q33a,'17')) %>%
  mutate_if(is.logical,as.numeric) # Makes 1 and 0

table(VV_2$Q33a_1)
table(VV_2$Q33a_2)
table(VV_2$Q33a_3)
table(VV_2$Q33a_4)
table(VV_2$Q33a_5)
table(VV_2$Q33a_6)
table(VV_2$Q33a_6)
table(VV_2$Q33a_7)
table(VV_2$Q33a_8)
table(VV_2$Q33a_9)
table(VV_2$Q33a_10)
table(VV_2$Q33a_11)
table(VV_2$Q33a_12)
table(VV_2$Q33a_13)
table(VV_2$Q33a_14)
table(VV_2$Q33a_15)
table(VV_2$Q33a_16)
table(VV_2$Q33a_17)
table(VV_2$Q33a,VV_2$Q33a_2)

Symptoms <- VV_2 %>%
  select(ResponseId,Weights,Q36c,Q33a,Q33a_1,Q33a_2,Q33a_3,Q33a_4,
         Q33a_5,Q33a_6,Q33a_7,Q33a_8,Q33a_9,Q33a_10,Q33a_11,Q33a_12,
         Q33a_13,Q33a_14,Q33a_15,Q33a_16,Q33a_17) %>%
  rename('Chest pain' = Q33a_1, 'High fever' = Q33a_2,
         'Muscle pain' = Q33a_3, 'Rising fever' = Q33a_4,
         'Runny nose' = Q33a_5, 'Shivers' = Q33a_6,
         'Short of breath' = Q33a_7, 'Sore eyes' = Q33a_8,
         'Sore throat' = Q33a_9, 'Other' = Q33a_10,
         'Dry cough' = Q33a_11, 'Wet cough' = Q33a_12,
         'Exhaustion' = Q33a_13, 'Nausea' = Q33a_14,
         'Diarrhoea' = Q33a_15, 'Lost taste' = Q33a_16, 'Lost smell' = Q33a_17) %>%
# c("Chest pain" = "1", "High fever \\(over 38°\\)" = "2"," Muscle pain" = "3","Rapidly rising fever" = "4","Runny nose" = "5", "Shivers" = "6","Shortness of breath" = "7","Sore eyes" = "8", "Sore throat" = "9","Other" = "10", "Dry, throaty cough" = "11","Rattly, chesty cough" = "12","Tired, exhausted" = "13","Nausea, vomiting" = "14", "Diarrhoea" = "15", "Loss of taste/appetite" = "16", No" = "999",.default = "9999999")
  pivot_longer(-c(ResponseId, Weights, Q36c, Q33a), names_to='Symptom', values_to='Count') %>%
  filter(!is.na(Q33a)) %>%
  filter(Count >0)

Symptoms_ResponseId <- Symptoms %>% group_by(Weights,ResponseId) %>%
  summarise(N=sum(Count))  %>% # Number of things done by each person 1 -3
  mutate(Adjusted_Weights = Weights/N)

g <- ggplot(Symptoms_ResponseId, aes(x=N)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of symptoms per person') + ylab('Count') +
  ggtitle('Reported symptoms', subtitle = 'in the last fortnight') +
  theme_classic(base_size = 25) 
g
##ggsave('images/Symptoms_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)

Symptoms_Experienced <- Symptoms %>%
  filter(!is.na(Q36c)) %>% # 3 cases did not express a view
  group_by(Q36c,Symptom) %>% 
  summarise(N=sum(Count)) %>% filter(N > 0) %>% arrange(desc(N)) %>%
  mutate(Symptom_f = fct_inorder(as_factor(Symptom)))

my_colours=c("yellow","green")
names(my_colours) = levels(VV_2$Q36c) # Yes and No, in that order

g <- ggplot(Symptoms_Experienced,
            aes(x=Symptom_f, y=N, fill=Q36c)) +
  scale_fill_manual(name = "Q36c", values = my_colours)  +
  geom_col(colour='black') +
  xlab('Type of symptom') + ylab('Count') +
  ggtitle('Number of people with each symptom') +
  guides(fill=guide_legend("Covid19?")) +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0,size = 15)) +
  theme(legend.title=element_text(size=rel(0.5))) +
  theme(legend.text=element_text(size=rel(0.3)))
g
##ggsave('images/Symtoms_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

g <- ggplot(Symptoms_Experienced,
            aes(x=Symptom_f, y=N, fill=Q36c)) +
  scale_fill_manual(name = "Q36c", values = my_colours)  +
  geom_col(colour='black') +
  xlab('Type of symptom') + ylab('Count') +
  ggtitle('Number of people with each symptom') +
  guides(fill=guide_legend("Covid19?")) +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0,size = 15)) +
  theme(legend.title=element_text(size=rel(0.5))) +
  theme(legend.text=element_text(size=rel(0.3)))
g
g + facet_wrap(~Q36c)

```

## Q34	Do you still have at least one of the symptoms you indicated?
```{r Q34 Still have a symptom?}

VV_2 %>% select(Q34) %>%
  group_by(Q34) %>% filter(!is.na(Q34)) %>%
  summarise(N = n()) %>% mutate(Pct = round(100*N/sum(N),2)) %>%
  kable(caption="People who still had a symptom at the time of the survey")

```

## Q35	How long did your symptoms last? (days)

```{r}
VV_2 %>% select(Q35) %>% group_by(Q35) %>% summarise(N = n())
table(VV_2$Q35,useNA = 'ifany')

VV_2 <- VV_2 %>% mutate(Q35a = recode(Q35,
                              "More than two weeks" = "14+"
                              )) %>%
  mutate(Q35a = as_factor(Q35a)) %>%
  mutate(Symptom_Duration = fct_relevel(Q35a,
                            "1","2","3","4","5","6","7",
                            "8","9","10","11","12","13","14",
                            "14+")) %>%
  mutate(Symptom_Duration_Integer = as.integer(Symptom_Duration))

g <- ggplot(data=VV_2 %>% filter(!is.na(Symptom_Duration)), 
            aes(x=Symptom_Duration)) +
  geom_bar(fill='yellow',colour='black') +
 # scale_x_discrete(breaks=(seq(from= 0, to = 30, by=7))) +
  xlab('Days') + ylab('Count') +
  ggtitle('Symptom duration') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(size = 15))
g
##ggsave('images/Symptom_Duration_.png',  g, width=10,height=7, units='in', dpi= 1200)

my_colours=c("yellow","green")
names(my_colours) = levels(VV_2$Q36c) # Yes and No, in that order

g <- ggplot(data=VV_2 %>% filter(Symptom_Duration < 32), 
            aes(x=Symptom_Duration, fill=Q36c)) +
  scale_fill_manual(name = "Q36c", values = my_colours)  +
  geom_histogram(colour='black',binwidth=3, position='dodge') +
  scale_x_continuous(breaks=(seq(from= 0, to = 30, by=7))) +
  xlab('Days') + ylab('Count') +
  ggtitle('Symptom duration') +
  guides(fill=guide_legend("Covid19?")) +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(size = 15)) +
  theme(legend.title=element_text(size=rel(0.5))) +
  theme(legend.text=element_text(size=rel(0.3)))
g
##ggsave('images/Symptom_Duration_.png',  g, width=10,height=7, units='in', dpi= 1200)

t.test(Symptom_Duration_Integer ~ Q36a, data=VV_2)
```

There is some indication of a  bimodal pattern, with one peak at  3 to 4 days, and a second at about 10 to days.

People who thought they might have COVID19 reported a longer duration of symptoms than those who did not (mean difference 3.8 days (95%CI 3.0 to 4.6 )).


## Q38 COVID19 test
Were you referred for testing?

```{r Referred for test}
VV_2 %>% select(Q38) %>% group_by(Q38) %>%
  summarise(N=n()) %>% filter(!is.na(Q38)) %>%
  mutate(Pct = round(100*N/sum(N),2)) %>%
  kable(caption="Number of people referred for testing")

chisq.test(VV_2$Q38,VV_2$Q36a)

```

About one third of those with symptoms were referred for testing. As you might expect there was a very strong association between being referred for testing, and suspecting that one might have COVID19 (chi-squared = 135.9, df = 1, p-value < 2.2e-16).

## Q39 Test outcome

```{r Test outcome}
VV_2 %>% select(Q39) %>% group_by(Q39) %>% summarise(N=n())

VV_2 <- VV_2 %>% mutate(Q39a = recode(Q39,
                              "Yes, GP" = NA_character_,
                              "No" = NA_character_,
                              "Still waiting to be tested." = "Wait - Test",
                              "Still waiting for result of test." = "Wait - Result",
                              "Negative." = "Negative",
                              "Positive." = "Positive",
                              .default=NA_character_)) %>%
  mutate(Q39a = as_factor(Q39a)) %>%
  mutate(Q39a = fct_relevel(Q39a,"Wait - Test","Wait - Result","Negative","Positive"))

VV_2 %>% select(Q39a) %>% group_by(Q39a) %>% summarise(N=n())


g <- ggplot(VV_2 %>% filter(!is.na(Q39a)), aes(x=Q39a)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Test_outcome') + ylab('Count') +
  ggtitle('Number of people with test outcome') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Test_Results_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

```

Far fewer were waiting for a test. Most of those tested were waiting, either for a test, or for the results of a test. Of the 207 test results that had come back 37% were positive, slightly higher than two weeks ago.

# Behaviours

## Q45 Government recommendations

On a scale of 0-10, how clear did you find the government recommendations on the following:(0 - bad, 10 - good) - Social distancing, Isolation, Leisure/travel, Shopping

```{r}
kable(table(VV_2$Q45_1),caption='Social distancing') # Social distancing
kable(table(VV_2$Q45_2),caption='Isolation') # Isolation
kable(table(VV_2$Q45_3),caption='Leisure') # Leisure
kable(table(VV_2$Q45_4),caption='Shopping') # Shopping

m1 <-  lm(Q45_1 ~ I(Age/10)+Sex+Education+Q9+Occupation,data=VV_2)
anova(m1)
summary(m1)
m2 <-  lm(Q45_2 ~ I(Age/10)+Sex+Education+Q9+Occupation,data=VV_2)
anova(m2)
summary(m2)
m3 <-  lm(Q45_3 ~ I(Age/10)+Sex+Education+Q9+Occupation,data=VV_2)
anova(m3)
summary(m3)
m4 <-  lm(Q45_4 ~ I(Age/10)+Sex+Education+Q9+Occupation,data=VV_2)
anova(m4)
summary(m4)

Heatmap <- VV_2 %>%
  select(Q45_1, Q45_2) %>%
  group_by(Q45_1,Q45_2) %>%
  summarise(Count = n())

ggplot(Heatmap,aes(x=Q45_1,y=Q45_2,fill=log(Count))) +
  geom_tile() +
  xlab('Social distancing') + ylab('Isolation') +
  ggtitle('Clarity of Government advice') +
  scale_fill_gradient(low = "white", high = "steelblue") +
  scale_x_binned(breaks=seq(from=0,t=10,by=2)) +
  scale_y_binned(breaks=seq(from=0,t=10,by=2)) +
  theme(legend.position="none")

Heatmap <- VV_2 %>%
  select(Q45_3, Q45_4) %>%
  group_by(Q45_3,Q45_4) %>%
  summarise(Count = n())

ggplot(Heatmap,aes(x=Q45_3,y=Q45_4,fill=log(Count))) +
  geom_tile() +
  xlab('Leisure') + ylab('Shopping') +
  ggtitle('Clarity of Government advice') +
  scale_fill_gradient(low = "white", high = "steelblue") +
  scale_x_binned(breaks=seq(from=0,t=10,by=2)) +
  scale_y_binned(breaks=seq(from=0,t=10,by=2)) +
  theme(legend.position="none")

g1 <- ggplot(data=VV_2 , aes(x=Q45_1)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Clarity of Government advice') + ylab('Count') +
  ggtitle('Social distancing') +
  scale_x_binned(breaks=seq(from=0,t=10,by=2)) +
  theme_classic(base_size = 20) +
  theme(axis.text.x = element_text(angle=-45, hjust=0),
        axis.title.x.bottom = element_text(size=16))
g1
g2 <- ggplot(data=VV_2 , aes(x=Q45_2)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Clarity of Government advice') + ylab('Count') +
  ggtitle('Isolation') +
  scale_x_binned(breaks=seq(from=0,t=10,by=2)) +
  theme_classic(base_size = 20) +
  theme(axis.text.x = element_text(angle=-45, hjust=0),
        axis.title.x.bottom = element_text(size=16))
g2
g3 <- ggplot(data=VV_2 , aes(x=Q45_3)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Clarity of Government advice') + ylab('Count') +
  ggtitle('Leisure') +
  scale_x_binned(breaks=seq(from=0,t=10,by=2)) +
  theme_classic(base_size = 20) +
  theme(axis.text.x = element_text(angle=-45, hjust=0),
        axis.title.x.bottom = element_text(size=16))
g3
g4 <- ggplot(data=VV_2 , aes(x=Q45_4)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Clarity of Government advice') + ylab('Count') +
  ggtitle('Shopping') +
  scale_x_binned(breaks=seq(from=0,t=10,by=2)) +
  theme_classic(base_size = 20) +
  theme(axis.text.x = element_text(angle=-45, hjust=0),
        axis.title.x.bottom = element_text(size=16))
g4

library(ggpubr)
figure <- ggarrange(g1,g2,g3,g4,
                    ncol = 2, nrow = 2)
figure
##ggsave('images/Clarity of advice.png',  figure, width=10,height=7, units='in', dpi= 1200)
```

In each case the commonest value chosen was 10/10, suggesting that the Government's recommendations are well understood, by most people. Men, younger people, those who reported both lower and higher than Leaving Certificate levels of education, and people not in formal employment, were all likely to assess the clarity of communication slightly less favourably.

## Q46 and Q47 Changes in your behaviour, and other people's behaviour

Q46 On a scale of 0-10, please indicate the extent to which you yourself have adapted your behaviour to the government recommendations:    (0 - no adaptation, 10 - Very Strong Adaptation) - At home, At work, In public places/shops

Q47 On a scale of 0-10, please indicate the extent to which people around you have adapted their behaviour to the government recommendations: (0 - No adaptation, 10 - Very Strong Adaptation) - At home, At work, In public places/shops

```{r Behaviours in contexts}
kable(table(VV_2$Q46_1),caption='Self at home') 
kable(table(VV_2$Q47_1),caption='Others at home')

kable(table(VV_2$Q46_2),caption='Self at work') 
kable(table(VV_2$Q47_2),caption='Others at work')

kable(table(VV_2$Q46_3),caption='Self in public places') 
kable(table(VV_2$Q47_3),caption='Others in public places')

Behaviour <- VV_2 %>%
  select(ResponseId,Q46_1,Q47_1,Q46_2,Q47_2,Q46_3,Q47_3,Weights) %>%
  mutate(Weights = as.character(Weights)) %>%
  pivot_longer(cols=-c(ResponseId, Weights), 
               names_to = 'Question', values_to = 'Count') %>%
  mutate(Weights = as.numeric(Weights)) %>%
  mutate(Person = ifelse(str_detect(Question,'46'),'Self','Others')) %>%
  mutate(Place = (recode(Question,
                      "Q46_1" = 'Home',
                       "Q46_2" = 'Work', 
                       "Q46_3" = 'Public place',
                       "Q47_1" = 'Home',
                       "Q47_2" = 'Work',
                       "Q47_3" = 'Public place')))

g <- ggplot(data=Behaviour,
             aes(x=Count,fill=Person)) +
  geom_bar(aes(weight = Weights), position = "dodge2",colour='black') +
  scale_fill_manual(values=c("yellow", "#E69F00", "#56B4E9")) +
  xlab('Adaptation of behaviours') + ylab('Count') +
  ggtitle('At home', subtitle = 'Weighted') +
  scale_x_binned(breaks=seq(from=0,t=10,by=1)) +
  theme_classic(base_size = 20) +
  theme(axis.text.x = element_text(angle=-45, hjust=0),
        axis.title.x.bottom = element_text(size=16)) +
  facet_wrap(~Place,nrow=1,scales='fixed')
g
##ggsave('images/Adaptation of behaviours.png',  g, width=10,height=7, units='in', dpi= 1200)
```

The large majority of people report that they have adapted their behaviour, and that others have done the same.

## Q48 Underlying disease
Do you have an underlying disease (e.g. heart disease, diabetes, hypertension) that is a risk factor for the new coronavirus?  (Tick any that apply)

```{r Underlying risk factor}
sort(unique(VV_2$Q48))[!str_detect(sort(unique(VV_2$Q48)),",")]
sort(unique(VV_2$Q48))[str_detect(sort(unique(VV_2$Q48)),"Preg")]


table(VV_2$Q48[nchar(VV_2$Q48)< 5]) # None

VV_2 <- VV_2 %>%
  mutate(Q48a = str_replace_all(Q48,
                       c("Asthma requiring medication" = '1',
                       "Chronic neurological disease" =  '2',
                       "Heart condition" = '3',
                       "High BMI \\(>=40\\)" = '4',
                       "Kidney disease" = '5',
                       "Chronic liver disease" = '6',
                       "Diabetes" = '7',
                       "High blood pressure" = '8',
                       "Immunodeficiency" = '9',
                       "Lung condition" = 'A',
                       "Recent cancer diagnosis" = 'B',
                       "None of the above" = 'C',
                       "Pregnancy" = "D"))) # Recode strings to numbers for ease of manipulation
sort(unique(VV_2$Q48a))[str_detect(sort(unique(VV_2$Q48a)),"D")]

VV_2 <- VV_2 %>%
  mutate(Q48a_1 = str_detect(Q48a,'1')) %>%
  mutate(Q48a_2 = str_detect(Q48a,'2')) %>%
  mutate(Q48a_3 = str_detect(Q48a,'3')) %>%
  mutate(Q48a_4 = str_detect(Q48a,'4')) %>%
  mutate(Q48a_5 = str_detect(Q48a,'5')) %>%
  mutate(Q48a_6 = str_detect(Q48a,'6')) %>%
  mutate(Q48a_7 = str_detect(Q48a,'7')) %>%
  mutate(Q48a_8 = str_detect(Q48a,'8')) %>%
  mutate(Q48a_9 = str_detect(Q48a,'9')) %>%
  mutate(Q48a_A = str_detect(Q48a,'A')) %>%
  mutate(Q48a_B = str_detect(Q48a,'B')) %>%
  mutate(Q48a_C = str_detect(Q48a,'C')) %>%
  mutate(Q48a_D = str_detect(Q48a,'D')) %>%
  mutate(Q48a_NA = is.na(Q48a))

table(VV_2$Q48a_5, useNA = 'ifany')
table(VV_2$Q48a_A, useNA = 'ifany')
table(VV_2$Q48a_D, useNA = 'ifany')
table(VV_2$Q48a_NA, useNA = 'ifany')
table(VV_2$Q48a,VV_2$Q48a_2, useNA = 'ifany')
table(VV_2$Q48a,VV_2$Q48a_B, useNA = 'ifany')

sort(unique(VV_2$Q48a))[!str_detect(sort(unique(VV_2$Q48a)),",")]
sort(unique(VV_2$Q48a))

HealthProblems <- VV_2 %>%
#  filter(!is.na(Upper_Secondary)) %>%
  select(ResponseId, Q48a_1, Q48a_2, Q48a_3, Q48a_4, Q48a_5, Q48a_6, Q48a_7,
         Q48a_8, Q48a_9, Q48a_A, Q48a_B, Q48a_C, Q48a_D, Q48a_NA, Weights) %>%
   rename("Asthma" = Q48a_1, "Neurological" = Q48a_2, "Heart" = Q48a_3,
          "High BMI" = Q48a_4, "Kidney" = Q48a_5, "Liver" = Q48a_6,
          "Diabetes" = Q48a_7, "High BP" = Q48a_8, "Immunodeficiency" = Q48a_9,
          "Lung" = Q48a_A, "Cancer" = Q48a_B,
          "None of these" = Q48a_C, "Pregnancy" = Q48a_D,"No reply" = Q48a_NA) %>%
  mutate_if(is.logical,as.numeric)

table(HealthProblems$'No reply')
table(HealthProblems$'None of these')

Health_Pivot <- HealthProblems %>%
  mutate(Weights = as.character(Weights)) %>%
  pivot_longer(cols=-c(ResponseId, Weights), 
               names_to = 'Type', values_to = 'Count') %>%
  mutate(Weights = as.numeric(Weights))

table(Health_Pivot$ResponseId, useNA = 'ifany')
table(Health_Pivot$Type, useNA = 'ifany')
table(Health_Pivot$Count,useNA = 'ifany')

Health_Count <- Health_Pivot %>%
  filter(Type != 'None of these') %>%
  filter(Type != 'No reply') %>%
  group_by(Weights,ResponseId) %>% # Problems per person
  summarise(N = sum(Count))

table(Health_Count$N,useNA = 'ifany')

g <- ggplot(Health_Count, aes(x=N)) +
  geom_bar(aes(weight = Weights), fill='yellow', colour='black') +
  xlab('Number of Health problems') + ylab('Count') +
  ggtitle('Reported health problems', subtitle = 'Weighted') +
  scale_x_binned(breaks=seq_along(0:12)) +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
g <- ggplot(Health_Count %>% filter(N > 0), aes(x=N)) +
  geom_bar(aes(weight = Weights), fill='yellow', colour='black') +
  xlab('Number of Health problems') + ylab('Count') +
  ggtitle('Reported health problems') +
  scale_x_binned(breaks=seq_along(0:12)) +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Healths_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)

Health_Type <- Health_Pivot %>% group_by(Type) %>%
  summarise(N = sum(Count)) %>%
  arrange(desc(N))

Levels <- Health_Type$Type
Levels

g <- ggplot(Health_Type %>% mutate(Type = factor(Type, levels=Levels)),
            aes(x=Type, y=N)) +
  geom_col(fill='yellow', colour='black') +
   xlab('Number of Health problems') + ylab('Count') +
  ggtitle('Reported health problems') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
g <- ggplot(Health_Type %>% filter(Type !='None of these') %>% mutate(Type = factor(Type, levels=Levels[-1])) , aes(x=Type, y=N)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Number of Health problems') + ylab('Count') +
  ggtitle('Reported health problems') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Healths_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

## Age and symptom count
g <- ggplot(Health_Count %>%
              inner_join(VV_2 %>% select(ResponseId, Age, Sex)),
            aes(x=Age, y=N, group=Sex, colour=Sex)) +
  ylim(0,4) +
  geom_jitter(alpha=0.01) +
  geom_smooth() +
  facet_wrap(~Sex,nrow=3)
g

```

By far the most common response was to report no problems. Of those who did report a problems, few had more than 2, and most had only 1. The commonest problems reported were high blood pressure, asthma, and (surprisingly) immunodeficiency. This was reportedly commoner than heart disease, diabetes, respiratory disease and a recent diagnosis of any cancer. This is unlikely to be correct, and shows a considerable gap between the lay understandings of the word immunodeficiency and the professional. Otherwise the pattern of symptom is as expected.
There is no strong link between reported age, and the number of problems reported.

## Q49 Relational tensions

Have you experienced any relational tensions since the quarantine measures? - With adults over 70 years of age, With adults between 18 and 70 years of age, With children between 12 and 17 years of age, With children under 12 years of age, With partner?

```{r Relationships}
VV_2 %>% select(Q49_1) %>% group_by(Q49_1) %>% summarise(N = n())
VV_2 <- VV_2 %>%
  mutate(Q49_1a = recode(Q49_1,
                         "No more than usual" = "No change",
                         "A little more than usual" = "A little more",
                         "Much more than usual" = "Much more",
                         .default=NA_character_
                         )) %>%
  mutate(Q49_1a = recode(Q49_1,
                         "No more than usual" = "No change",
                         "A little more than usual" = "A little more",
                         "Much more than usual" = "Much more",
                         .default=NA_character_
                         )) %>%
  mutate(Q49_2a = recode(Q49_2,
                         "No more than usual" = "No change",
                         "A little more than usual" = "A little more",
                         "Much more than usual" = "Much more",
                         .default=NA_character_
                         )) %>%
  mutate(Q49_3a = recode(Q49_3,
                         "No more than usual" = "No change",
                         "A little more than usual" = "A little more",
                         "Much more than usual" = "Much more",
                         .default=NA_character_
                         )) %>%
  mutate(Q49_4a = recode(Q49_4,
                         "No more than usual" = "No change",
                         "A little more than usual" = "A little more",
                         "Much more than usual" = "Much more",
                         .default=NA_character_
                         )) %>%
  mutate(Q49_5a = recode(Q49_5,
                         "No more than usual" = "No change",
                         "A little more than usual" = "A little more",
                         "Much more than usual" = "Much more",
                         .default=NA_character_
                         ))


VV_2 <- VV_2 %>%
  mutate_at(c('Q49_1a','Q49_2a','Q49_3a','Q49_4a','Q49_5a'), as_factor) %>% 
  mutate_at(c('Q49_1a','Q49_2a','Q49_3a','Q49_4a','Q49_5a'), fct_infreq)

levels(VV_2$Q49_3a)

Relationship <- VV_2 %>% select(ResponseId,Q49_1a,Q49_2a,Q49_3a,Q49_4a,Q49_5a) %>%
  pivot_longer(-ResponseId,names_to='Relation', values_to='Tension') %>%
  filter(!is.na(Tension)) %>%
  mutate(Relation = recode(Relation,
                           'Q49_1a' = "Older adults" ,
                           'Q49_2a' = "Adults",
                           'Q49_3a' = "Older children",
                           'Q49_4a' = "Younger children",
                           'Q49_5a' = "Partner")) %>%
  mutate(Relation = as_factor(Relation)) %>%
  mutate(Relation = fct_relevel(Relation,
                    "Partner",
                    "Younger children", "Older children",
                    "Adults", "Older adults"))

glimpse(Relationship)
levels(Relationship$Tension)
levels(Relationship$Relation)
Relationship_Count <- Relationship %>%
  group_by(ResponseId) %>% # Problems per person
  summarise(N = n())

Relationship_Type <- Relationship %>% group_by(Tension,Relation) %>%
  summarise(N = n()) %>%
  arrange(desc(N))

g <- ggplot(Relationship_Type, aes(x=Tension, y=N)) +
  geom_col(fill='yellow', colour='black') +
   xlab('Level of tension') + ylab('Count') +
  ggtitle('Tension in relationships') +
  theme_classic(base_size = 20) +
  theme(axis.text.x = element_text(angle=-45, hjust=0)) +
  facet_wrap(~Relation)
g
##ggsave('images/Relationship_tensions.png',  g, width=10,height=7, units='in', dpi= 1200)
```

## Q50 Activities chosen
Q50 Which of the following activities have you been able to do in the past week?

```{r Activities}
table(VV_2$Q50)
sort(unique(VV_2$Q50))[!str_detect(sort(unique(VV_2$Q50)),",")]

VV_2 <- VV_2 %>%
  mutate(Q50a = str_replace_all(Q50,
                       c("Board games \\(online or not\\) with other people" = '1',
                       "Chatting with other people in the open air more than 2m apart" = '2',
                       "Chatting with other people while you can't see them \\(e.g. by phone\\)" = '3',
                       "Chatting with other people while you see them on a screen" = '4',
                       "Going for a walk outside \\(apart from going to the shop\\)" = '5',
                       "Going outside cycling \\(separate from going to the shop\\)" = '6',
                       "Indoor exercises \\(yoga, stretching, exercise bike\\)" = '7',
                       "Gardening" = '8',
                       "DIY" = '9'))) %>%
  mutate(Q50a = str_replace_all(Q50a,c(" " = '')))
sort(unique(VV_2$Q50a))[!str_detect(sort(unique(VV_2$Q50a)),",")]
sort(unique(VV_2$Q50a))[str_detect(sort(unique(VV_2$Q50a)),",")]

VV_2 <- VV_2 %>%
  mutate(Q50a_1 = str_detect(Q50a,'1')) %>%
  mutate(Q50a_2 = str_detect(Q50a,'2')) %>%
  mutate(Q50a_3 = str_detect(Q50a,'3')) %>%
  mutate(Q50a_4 = str_detect(Q50a,'4')) %>%
  mutate(Q50a_5 = str_detect(Q50a,'5')) %>%
  mutate(Q50a_6 = str_detect(Q50a,'6')) %>%
  mutate(Q50a_7 = str_detect(Q50a,'7')) %>%
  mutate(Q50a_8 = str_detect(Q50a,'8')) %>%
  mutate(Q50a_9 = str_detect(Q50a,'9'))

table(VV_2$Q50a_1)
table(VV_2$Q50a_2)
table(VV_2$Q50a_3)
table(VV_2$Q50a_4)
table(VV_2$Q50a_5)
table(VV_2$Q50a_6)
table(VV_2$Q50a_7)
table(VV_2$Q50a_8)
table(VV_2$Q50a_9)

table(VV_2$Q50a,VV_2$Q50a_2)

Activity <- VV_2 %>%
  select(ResponseId,Q50a_1,Q50a_2,Q50a_3,Q50a_4,Q50a_5,Q50a_6,Q50a_7,Q50a_8,Q50a_9) %>%
  rename('Board games' = Q50a_1, 'Open air chat' = Q50a_2,
         'Phone chat' = Q50a_3, 'Video chat' = Q50a_4, 'Walking' = Q50a_5,
         'Cycling' = Q50a_6, 'Indoor exercise' = Q50a_7,
         'Gardening' = Q50a_8, 'DIY' = Q50a_9) %>%
  pivot_longer(-ResponseId, names_to='Activity', values_to='count') %>%
  mutate(count = as.numeric(count)) %>%
  mutate_all(~replace(., is.na(.), 0))

Activity_ResponseId <- Activity %>% group_by(ResponseId) %>%
  summarise(n=sum(count))

Activity_Act <- Activity %>% group_by(Activity) %>%
  summarise(n=sum(count))

g <- ggplot(Activity_ResponseId, aes(x=n)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of activities reported') + ylab('Count') +
  ggtitle('Reported activities') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Activities_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)


g <- ggplot(Activity_Act, aes(x=Activity, y=n)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Activity') + ylab('Count') +
  ggtitle('Number of people reporting each activity') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Activites_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

```

# Mental health etc. 

## Q51 to Q59

How much of the time during the past week did you feel full of life?
How much of the time during the past week have you been a very nervous person?
How much of the time during the past week have you felt so down in the dumps that nothing could cheer you up?
How much of the time during the past week have you felt calm and peaceful?
How much of the time during the past week did you have a lot of energy?
How much of the time during the past week have you felt downhearted and blue?
How much of the time during the past week have you been a happy person?
How much of the time during the past week did you feel worn out?
How much of the time during the past week did you feel tired?

```{r Mental health}
library(sjPlot)
sort(unique(VV_2$Q55))
LEVELS = c("None of the time", "A little of the time", "Some of the time", "A good bit of the time", "Most of the time", "All of the time")

     
table(VV_2$Q51)

Likert <- VV_2 %>%
  select(Q51,Q52,Q53,Q54,Q55,Q56,Q57,Q58,Q59) %>%
  mutate(Q51 = factor(Q51,levels=LEVELS)) %>%
  mutate(Q52 = factor(Q52,levels=LEVELS)) %>%
  mutate(Q53 = factor(Q53,levels=LEVELS)) %>%
  mutate(Q54 = factor(Q54,levels=LEVELS)) %>%
  mutate(Q55 = factor(Q55,levels=LEVELS)) %>%
  mutate(Q56 = factor(Q56,levels=LEVELS)) %>%
  mutate(Q57 = factor(Q57,levels=LEVELS)) %>%
  mutate(Q58 = factor(Q58,levels=LEVELS)) %>%
  mutate(Q59 = factor(Q59,levels=LEVELS)) %>%
  rename(Life = Q51, Nervous = Q52, Depressed = Q53,
         Calm = Q54, Energetic = Q55, Blue = Q56, Happy = Q57,
         Worn_out = Q58, Tired = Q59)

table(Likert$Worn_out,Likert$Tired)

items = c("Full of life","Very nervous","Down in the dumps","Calm and peaceful","Lots of energy","Downhearted and blue","A happy person","Worn out","Tired")

plot_likert(Likert[1:300,])

g <- plot_likert(Likert, axis.labels = items,
             sort.frq = 'pos.asc', values = 'hide',
            show.n = FALSE, geom.colors = 'Spectral',
            title='Mood over the last week')
g
##ggsave('images/Likert_Mood.png',  g, width=10,height=7, units='in', dpi= 1200)
```

Most people are positive, few report being down all or most of the time over the last week, and many describe themselves as happy, calm, or full of life.

```{r Calculate MOS score(s)}
#Recoding items
#Items 52, 53, 56, 58, 59
#All of the time (1)         0
#Most of the time (2)       20
#A good bit of the time (3) 40
#Some of the time (4)       60
#A little of the time (5)   80
#None of the time (6)      100

VV_2 <- VV_2 %>%
  mutate(Q52a = recode(Q52,"All of the time" = "0", "Most of the time" = "20",
                       "A good bit of the time" = "40", "Some of the time" = "60",
                       "A little of the time" = "80", "None of the time" = "100",
                       .default=NA_character_)) %>%
  mutate(Q53a = recode(Q53,"All of the time" = "0", "Most of the time" = "20",
                       "A good bit of the time" = "40", "Some of the time" = "60",
                       "A little of the time" = "80", "None of the time" = "100",
                       .default=NA_character_)) %>%
  mutate(Q56a = recode(Q56,"All of the time" = "0", "Most of the time" = "20",
                       "A good bit of the time" = "40", "Some of the time" = "60",
                       "A little of the time" = "80", "None of the time" = "100",
                       .default=NA_character_)) %>%
  mutate(Q58a = recode(Q58,"All of the time" = "0", "Most of the time" = "20",
                       "A good bit of the time" = "40", "Some of the time" = "60",
                       "A little of the time" = "80", "None of the time" = "100",
                       .default=NA_character_)) %>%
  mutate(Q59a = recode(Q59,"All of the time" = "0", "Most of the time" = "20",
                       "A good bit of the time" = "40", "Some of the time" = "60",
                       "A little of the time" = "80", "None of the time" = "100",
                       .default=NA_character_))

#Items 51, 54, 55, 57
#Questionnaire response
#Recode
#All of the time (1)       100
#Most of the time (2)       80
#A good bit of the time (3) 60
#Some of the time (4)       40
#A little of the time (5)   20
#None of the time (6)        0
VV_2 <- VV_2 %>%
  mutate(Q51a = recode(Q51,"All of the time" = "100", "Most of the time" = "80",
                       "A good bit of the time" = "60", "Some of the time" = "40",
                       "A little of the time" = "20", "None of the time" = "0",
                       .default=NA_character_)) %>%
  mutate(Q54a = recode(Q54,"All of the time" = "100", "Most of the time" = "80",
                       "A good bit of the time" = "60", "Some of the time" = "40",
                       "A little of the time" = "20", "None of the time" = "0",
                       .default=NA_character_)) %>%
  mutate(Q55a = recode(Q55,"All of the time" = "100", "Most of the time" = "80",
                       "A good bit of the time" = "60", "Some of the time" = "40",
                       "A little of the time" = "20", "None of the time" = "0",
                       .default=NA_character_)) %>%
  mutate(Q57a = recode(Q57,"All of the time" = "100", "Most of the time" = "80",
                       "A good bit of the time" = "60", "Some of the time" = "40",
                       "A little of the time" = "20", "None of the time" = "0",
                       .default=NA_character_))

VV_2 <- VV_2 %>% mutate_at(vars(Q52a:Q57a), as.numeric) # _at links ot a Location

#Scales calculation
#Energy and vitality (4 items): 51,55,58,59
#Add the recoded item scores together and divide by 4 to give the scale score

VV_2 <- VV_2 %>% mutate(MOS_EV = Q51a + Q55a + Q58a + Q59a) 

#Mental health index (5 items): 52,53,54,56,57
#Add the recoded item scores together and divide by 5 to give the scale score

VV_2 <- VV_2 %>% mutate(MOS_MH = Q52a + Q53a + Q54a + Q56a + Q57a) 

#References
#https://www.rand.org/health-care/surveys_tools/mos/36-item-short-form.html

g <- ggplot(data=VV_2,
            aes(x=MOS_EV)) +
  geom_bar(fill='yellow',colour='black') +
  #scale_x_continuous(breaks=(seq(from= 0, to = 30, by=7))) +
  #xlab('Days') + ylab('Count') +
  ggtitle('Medical Outcomes Scale', subtitle='Energy and Vitality') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(size = 15))
g

g <- ggplot(data=VV_2,
            aes(x=MOS_MH)) +
  geom_bar(fill='yellow',colour='black') +
  #scale_x_continuous(breaks=(seq(from= 0, to = 30, by=7))) +
  #xlab('Days') + ylab('Count') +
  ggtitle('Medical Outcomes Scale', subtitle='Mental health') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(size = 15))
g

```



# Care postponed

## Q98 Waiting for care

Code responses to Q98 'What kind of treatment or check-up do you need or are you waiting for?'

```{r Q98}
table(VV_2$Q98)
sort(unique(VV_2$Q98))[str_detect(sort(unique(VV_2$Q98)),",")] # Components of answer

VV_2 <- VV_2 %>%
  mutate(Q98a = str_replace_all(Q98,
                       c("A consultation with my GP or other health professional." = "1",
                         "A medical examination in hospital" = "2",
                         "An operation in hospital" = "3",
                         "Preventive routine examinations, such as dental care, cancer screening, eye or ear examination, etc." = "4",
                         "Other" = "5",
                         .default = NA_character_)))
table(VV_2$Q98a, useNA = 'ifany')

VV_2 <- VV_2 %>%
  mutate(Q98a_1 = str_detect(Q98a,'1')) %>%
  mutate(Q98a_2 = str_detect(Q98a,'2')) %>%
  mutate(Q98a_3 = str_detect(Q98a,'3')) %>%
  mutate(Q98a_4 = str_detect(Q98a,'4')) %>%
  mutate(Q98a_5 = str_detect(Q98a,'5'))

table(VV_2$Q98a_5)
table(VV_2$Q98a,VV_2$Q98a_2)

Care_Delayed <- VV_2 %>%
  select(ResponseId,Q98a_1,Q98a_2,Q98a_3,Q98a_4,Q98a_5) %>%
  rename('Consultation' = Q98a_1, 'Examination' = Q98a_2,
         'Operation' = Q98a_3, 'Prevention' = Q98a_4, 'Other' = Q98a_5) %>%
  pivot_longer(-ResponseId, names_to='Type', values_to='Count') %>%
  mutate(Count = as.numeric(Count)) %>%
  mutate_all(~replace(., is.na(.), 0))

Care_Delayed %>% group_by(Count) %>% summarise(Sum = sum(Count))

Care_Delayed_ResponseId <- Care_Delayed %>% group_by(ResponseId) %>%
  summarise(N=sum(Count))
Care_Delayed_ResponseId %>% group_by(N) %>% summarise(Sum = sum(N))

g <- ggplot(Care_Delayed_ResponseId, aes(x=N)) +
  geom_bar(fill='yellow',colour='black') +
  xlab('Number of care episodes missed') + ylab('Count') +
  scale_x_continuous(breaks=c(0,1,2,3,4,5)) +
  ggtitle('Reported care episodes') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Activities_by_person.png',  g, width=10,height=7, units='in', dpi= 1200)

Care_Delayed_Type <- Care_Delayed %>% group_by(Type) %>%
  summarise(Count=sum(Count)) %>%
  mutate(Type = as_factor(Type)) %>%
  mutate(Type = fct_relevel(Type, 'Consultation', 'Prevention',
                            'Examination', 'Operation', 'Other'))
  

g <- ggplot(Care_Delayed_Type, aes(x=Type, y=Count)) +
  geom_col(fill='yellow',colour='black') +
  xlab('Type of care') + ylab('Count') +
  ggtitle('Number of people missing each type of care') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-45, hjust=0))
g
##ggsave('images/Activites_totals.png',  g, width=10,height=7, units='in', dpi= 1200)

```

## Q98 Details
Manually code further detailed responses given by 1402 participants to 'What kind of treatment or check-up do you need or are you waiting for?'

```{r Recode text responses}
Care_Postponed <- VV_2 %>% select(Q96,Q97,Q98,Q98_5_TEXT) %>% group_by(Q96,Q97,Q98,Q98_5_TEXT) %>% add_tally() %>% distinct()
write_csv(Care_Postponed,'data/Survey2/Care_Postponed.csv')

#manually coded and counted

Care_Postponed_Coded <- read_csv('data/Survey2/Care_Postponed Coded.csv')
names(Care_Postponed_Coded)

Care_Postponed_Coded %>% group_by(Postponed_Care) %>% summarise(Total = sum(n)) %>% arrange(desc(Total)) %>% mutate(Pct = round(Total/sum(Total),2))

VV_2 <- VV_2 %>% inner_join(Care_Postponed_Coded %>% select(-n), by = c("Q96", "Q97", "Q98", "Q98_5_TEXT")) %>% glimpse()

rm(Care_Postponed, Care_Postponed_Coded)
```

# Lock-down
Q99_1	If any of the following restrictions could be lifted, please arrange them into the order in which you would like to see this happen: (hold down and drag up or down) - Small group (max 3) meetings (respecting 2 meter distancing)
Q99_2	If any of the following restrictions could be lifted, please arrange them into the order in which you would like to see this happen: (hold down and drag up or down) - Be able to go outside beyond 2 km (respecting 2 meter distancing)
Q99_3	If any of the following restrictions could be lifted, please arrange them into the order in which you would like to see this happen: (hold down and drag up or down) - Open schools/childcare (with strong hygiene practices and social distancing)
Q99_4	If any of the following restrictions could be lifted, please arrange them into the order in which you would like to see this happen: (hold down and drag up or down) - Allow people to go back to work (with strong hygiene practices and social distancing)
Q99_5	If any of the following restrictions could be lifted, please arrange them into the order in which you would like to see this happen: (hold down and drag up or down) - Open shops/restaurants/pubs (with strong hygiene practices and social distancing)


```{r Lock-down}
VV_2 %>% select(Q99_1) %>% group_by(Q99_1) %>% summarise(N = n())
VV_2 %>% select(Q99_2) %>% group_by(Q99_2) %>% summarise(N = n())
VV_2 %>% select(Q99_3) %>% group_by(Q99_3) %>% summarise(N = n())
VV_2 %>% select(Q99_4) %>% group_by(Q99_4) %>% summarise(N = n())
VV_2 %>% select(Q99_5) %>% group_by(Q99_5) %>% summarise(N = n())

Lock_Down <- VV_2 %>%
  select(ResponseId,Age,Sex,County,Q99_1,Q99_2,Q99_3,Q99_4,Q99_5) %>%
  filter(!is.na(Q99_1))

Lock_Down %>% select(Q99_1) %>% group_by(Q99_1) %>% summarise(N = n())
Lock_Down %>% select(Q99_2) %>% group_by(Q99_2) %>% summarise(N = n())
Lock_Down %>% select(Q99_3) %>% group_by(Q99_3) %>% summarise(N = n())
Lock_Down %>% select(Q99_4) %>% group_by(Q99_4) %>% summarise(N = n())
Lock_Down %>% select(Q99_5) %>% group_by(Q99_5) %>% summarise(N = n())

Lock_Down <- Lock_Down %>%
  pivot_longer(-c(ResponseId, Age, Sex, County),names_t='Measure', values_to = 'Rank') %>%
  mutate(Measure = recode(Measure,
                          "Q99_1" = "Small meetings",
                          "Q99_2" = "Over 2km.",
                          "Q99_3" = "Open Schools",
                          "Q99_4" = "Back to work",
                          "Q99_5" = "Open shops, pubs",
                          )) %>%
  mutate(Measure = as_factor(Measure)) %>%
  mutate(Measure = fct_relevel(Measure,"Over 2km.", "Small meetings",
                               "Back to work", "Open Schools",
                               "Open shops, pubs"))
g <- ggplot(Lock_Down, aes(y=Measure,x = Rank)) +
  geom_boxplot(fill='yellow', colour='black') +
  ggtitle('Preferences for moving out of lock-down') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-90, hjust=0))

g
##ggsave('images/LockDown_.png',  g, width=10,height=7, units='in', dpi= 1200)

g <- ggplot(Lock_Down, aes(y=Measure,x = Rank, )) +
  geom_boxplot(fill='yellow',colour='black') +
  facet_wrap(~Sex) +
  ggtitle('Preferences for moving out of lock down', subtitle='by Sex') +
  theme_classic(base_size = 25) +
  theme(axis.text.x = element_text(angle=-90, hjust=0))
g
##ggsave('images/Lockdown_Sex.png',  g, width=10,height=7, units='in', dpi= 1200)

model <- lm(Rank ~Measure + Sex+ I(Age/10), data=Lock_Down %>% filter(Sex != 'Other'))
summary(model)
confint(model)

model <- lm(Rank ~Measure * Sex + I(Age/10), data=Lock_Down %>% filter(Sex != 'Other'))
summary(model)
confint(model)
anova(model)

g <- plot_model(model)
g <- g +
  ggtitle('Preferences for moving out of lock down', subtitle='Effect on ranking') +
  ylab('Estimates from regression model') +
  xlab('Model terms') +
  theme_classic(base_size = 20) 
g
g2 <- plot_model(model,type='int')
g2 <- g2 +
  ggtitle('Preferences for moving out of lock down', subtitle='Effect on ranking') +
  ylab('Rank estimates from regression model') +
  xlab('Model terms') +
  scale_y_continuous(trans = "reverse") +
  theme_classic(base_size = 20) 
g2
```

These models show an interesting pattern of differences between women and men. Women rank 'allowing small meetings' higher than 'going back to work', while for men these two rankings are reversed. Both agree that the highest priority is allowing a wider range of travel, and the lowest opening of pubs, restaurants, and non-essential shops.

# Save new file

Finally we save the survey into one data frame.

```{r save file}

save(VV_2,file = 'data/Survey2/Survey_Cleaned_2.rda')
write_csv(VV_2,'data/Survey2/Survey_Cleaned_2.csv')

```
